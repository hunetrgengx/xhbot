# 贴纸检验：误触分析与优缺点

## 一、逻辑说明

在「验证码等待」为否、「广告验证」之前，新增贴纸检验：若用户发送**纯贴纸**（无文字、无 caption），则触发人机验证。

- **位置**：`group_message_handler` 中，`pending_verification` 之后、`_is_ad_message` 之前
- **开关**：`ENABLE_STICKER_CHECK` 环境变量，默认 1（开启），设为 0 可关闭
- **白名单**：白名单用户不受影响，直接通过

---

## 二、误触几率分析

### 2.1 误触定义

**误触**：正常用户首次入群或首次发言时发贴纸，被要求人机验证。

### 2.2 误触对象

- 新入群用户，第一句话是贴纸
- 已在群内但未通过验证的用户，首次发言为贴纸

### 2.3 误触几率估算

| 因素 | 说明 |
|------|------|
| **贴纸使用习惯** | 贴纸在群聊中很常见，用于表情、反馈、庆祝等 |
| **群类型** | 女仆/交流群、表情包群中，贴纸使用率更高 |
| **首次发言形式** | 部分用户习惯用贴纸打招呼或表达情绪 |
| **粗略估计** | 首次发言为贴纸的比例约 **10%～30%**（视群氛围而定） |

**结论**：误触率中等偏高。在贴纸文化较重的群，约 1～3 成新用户会被要求验证。

---

## 三、优缺点

### 3.1 优点

| 优点 | 说明 |
|------|------|
| **防机器人刷贴纸** | 机器人常用贴纸刷屏，贴纸无文字，难以用关键词过滤 |
| **补齐过滤盲区** | 贴纸无法做 text/name 关键词检测，单独检验合理 |
| **与 emoji 逻辑一致** | 与 emoji 校验类似，都是低信息量内容的人机校验 |
| **可配置** | `ENABLE_STICKER_CHECK=0` 可随时关闭 |

### 3.2 缺点

| 缺点 | 说明 |
|------|------|
| **误触** | 正常用户发贴纸被拦，需多一步验证，体验变差 |
| **群氛围影响** | 贴纸多的群（如女仆/交流群），误触更明显 |
| **无区分度** | 无法区分「正常贴纸」与「广告贴纸」，一律要求验证 |

---

## 四、建议

1. **贴纸文化重的群**：可考虑 `ENABLE_STICKER_CHECK=0` 关闭
2. **广告/机器人多的群**：建议保持开启
3. **观察运行数据**：关注 sticker 触发量、通过率，再决定是否长期开启
